<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>BarcodeGenerator Benchmark Results</title>
    <meta name="description" content="Continuous benchmark results for the TyKonKet BarcodeGenerator .NET library">
    
    <!-- Embedded Bootstrap CSS (minimal version) -->
    <style>
        /* Bootstrap 5.3.0 Essential Components */
        *,*::before,*::after{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:var(--bs-body-font-family);font-size:var(--bs-body-font-size);font-weight:var(--bs-body-font-weight);line-height:var(--bs-body-line-height);color:var(--bs-body-color);text-align:var(--bs-body-text-align);background-color:var(--bs-body-bg);-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:rgba(0,0,0,0)}:root{--bs-blue:#0d6efd;--bs-indigo:#6610f2;--bs-purple:#6f42c1;--bs-pink:#d63384;--bs-red:#dc3545;--bs-orange:#fd7e14;--bs-yellow:#ffc107;--bs-green:#198754;--bs-teal:#20c997;--bs-cyan:#0dcaf0;--bs-primary:#0d6efd;--bs-secondary:#6c757d;--bs-success:#198754;--bs-info:#0dcaf0;--bs-warning:#ffc107;--bs-danger:#dc3545;--bs-light:#f8f9fa;--bs-dark:#212529;--bs-primary-rgb:13,110,253;--bs-secondary-rgb:108,117,125;--bs-success-rgb:25,135,84;--bs-info-rgb:13,202,240;--bs-warning-rgb:255,193,7;--bs-danger-rgb:220,53,69;--bs-light-rgb:248,249,250;--bs-dark-rgb:33,37,41;--bs-white-rgb:255,255,255;--bs-black-rgb:0,0,0;--bs-body-color-rgb:33,37,41;--bs-body-bg-rgb:255,255,255;--bs-font-sans-serif:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue","Noto Sans","Liberation Sans",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";--bs-font-monospace:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;--bs-gradient:linear-gradient(180deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0));--bs-body-font-family:var(--bs-font-sans-serif);--bs-body-font-size:1rem;--bs-body-font-weight:400;--bs-body-line-height:1.5;--bs-body-color:#212529;--bs-body-bg:#fff;--bs-border-width:1px;--bs-border-style:solid;--bs-border-color:#dee2e6;--bs-border-color-translucent:rgba(0, 0, 0, 0.175);--bs-border-radius:0.375rem;--bs-border-radius-sm:0.25rem;--bs-border-radius-lg:0.5rem;--bs-border-radius-xl:1rem;--bs-border-radius-2xl:2rem;--bs-border-radius-pill:50rem;--bs-link-color:#0d6efd;--bs-link-hover-color:#0a58ca;--bs-code-color:#d63384;--bs-highlight-bg:#fff3cd}.container,.container-fluid,.container-lg,.container-md,.container-sm,.container-xl,.container-xxl{width:100%;padding-right:var(--bs-gutter-x,.75rem);padding-left:var(--bs-gutter-x,.75rem);margin-right:auto;margin-left:auto}@media (min-width:576px){.container-sm,.container{max-width:540px}}@media (min-width:768px){.container-md,.container-sm,.container{max-width:720px}}@media (min-width:992px){.container-lg,.container-md,.container-sm,.container{max-width:960px}}@media (min-width:1200px){.container-xl,.container-lg,.container-md,.container-sm,.container{max-width:1140px}}@media (min-width:1400px){.container-xxl,.container-xl,.container-lg,.container-md,.container-sm,.container{max-width:1320px}}.row{--bs-gutter-x:1.5rem;--bs-gutter-y:0;display:flex;flex-wrap:wrap;margin-top:calc(-1 * var(--bs-gutter-y));margin-right:calc(-0.5 * var(--bs-gutter-x));margin-left:calc(-0.5 * var(--bs-gutter-x))}.row>*{flex-shrink:0;width:100%;max-width:100%;padding-right:calc(var(--bs-gutter-x) * 0.5);padding-left:calc(var(--bs-gutter-x) * 0.5);margin-top:var(--bs-gutter-y)}.col{flex:1 0 0%}.col-12{flex:0 0 auto;width:100%}@media (min-width:768px){.col-md-4{flex:0 0 auto;width:33.33333333%}.col-md-6{flex:0 0 auto;width:50%}.col-md-8{flex:0 0 auto;width:66.66666667%}}@media (min-width:992px){.col-lg-3{flex:0 0 auto;width:25%}.col-lg-4{flex:0 0 auto;width:33.33333333%}.col-lg-6{flex:0 0 auto;width:50%}.col-lg-9{flex:0 0 auto;width:75%}}.btn{display:inline-block;font-weight:400;line-height:1.5;color:#212529;text-align:center;text-decoration:none;vertical-align:middle;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;user-select:none;background-color:transparent;border:1px solid transparent;padding:0.375rem 0.75rem;font-size:1rem;border-radius:0.375rem;transition:color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out}.btn:hover{color:#212529}.btn-primary{color:#fff;background-color:#0d6efd;border-color:#0d6efd}.btn-primary:hover{color:#fff;background-color:#0b5ed7;border-color:#0a58ca}.btn-outline-primary{color:#0d6efd;border-color:#0d6efd}.btn-outline-primary:hover{color:#fff;background-color:#0d6efd;border-color:#0d6efd}.btn-outline-secondary{color:#6c757d;border-color:#6c757d}.btn-outline-secondary:hover{color:#fff;background-color:#6c757d;border-color:#6c757d}.btn-sm{padding:0.25rem 0.5rem;font-size:0.875rem;border-radius:0.25rem}.card{position:relative;display:flex;flex-direction:column;min-width:0;word-wrap:break-word;background-color:#fff;background-clip:border-box;border:1px solid rgba(0,0,0,.125);border-radius:0.375rem}.card-body{flex:1 1 auto;padding:1rem}.card-title{margin-bottom:0.5rem}.card-text:last-child{margin-bottom:0}.badge{display:inline-block;padding:0.35em 0.65em;font-size:0.75em;font-weight:700;line-height:1;color:#fff;text-align:center;white-space:nowrap;vertical-align:baseline;border-radius:0.375rem}.badge-bg-success{background-color:#198754!important}.badge-bg-warning{background-color:#ffc107!important;color:#000!important}.badge-bg-danger{background-color:#dc3545!important}.text-center{text-align:center!important}.text-muted{color:#6c757d!important}.text-md-end{text-align:end!important}@media (min-width:768px){.text-md-end{text-align:end!important}}.me-2{margin-right:0.5rem!important}.mb-2{margin-bottom:0.5rem!important}.mb-3{margin-bottom:1rem!important}.mb-4{margin-bottom:1.5rem!important}.ms-2{margin-left:0.5rem!important}.mt-3{margin-top:1rem!important}.p-3{padding:1rem!important}.d-flex{display:flex!important}.flex-wrap{flex-wrap:wrap!important}.justify-content-between{justify-content:space-between!important}.align-items-center{align-items:center!important}.shadow{box-shadow:0 .5rem 1rem rgba(0,0,0,.15)!important}.shadow-sm{box-shadow:0 .125rem .25rem rgba(0,0,0,.075)!important}.h-100{height:100%!important}

        /* Custom CSS for the benchmark page */
        :root {
            --primary-color: #0d6efd;
            --secondary-color: #6c757d;
            --success-color: #198754;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --dark-color: #212529;
            --light-color: #f8f9fa;
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-secondary: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        [data-theme="dark"] {
            --bs-body-color: #e9ecef;
            --bs-body-bg: #212529;
            --bs-dark: #e9ecef;
            --bs-light: #343a40;
        }

        [data-theme="dark"] .card {
            background-color: #343a40;
            border-color: #495057;
            color: #e9ecef;
        }

        [data-theme="dark"] .navbar {
            background-color: #343a40 !important;
        }

        [data-theme="dark"] .hero-section {
            background: linear-gradient(135deg, #495057 0%, #343a40 100%);
        }

        [data-theme="dark"] .hero-section h1 {
            color: #f8f9fa !important;
        }

        [data-theme="dark"] .hero-section .lead {
            color: #e9ecef !important;
        }

        [data-theme="dark"] .text-muted {
            color: #adb5bd !important;
        }

        [data-theme="dark"] a {
            color: #6cb2eb !important;
        }

        [data-theme="dark"] a:hover {
            color: #85c4f0 !important;
        }

        body {
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .hero-section {
            background: var(--gradient-primary);
            color: white;
            padding: 4rem 0;
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
        }

        .hero-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.1'%3E%3Cpath d='m36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E") repeat;
            opacity: 0.1;
        }

        .hero-content {
            position: relative;
            z-index: 1;
        }

        .stats-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 1.5rem;
            margin: 1rem 0;
            color: white;
            transition: transform 0.3s ease;
        }

        .stats-card:hover {
            transform: translateY(-5px);
        }

        .chart-container {
            position: relative;
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            margin: 1rem 0;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        [data-theme="dark"] .chart-container {
            background: #343a40;
            color: #e9ecef;
        }

        .chart-container:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
        }

        .performance-badge {
            font-size: 0.8rem;
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            font-weight: 600;
        }

        .badge-improved {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
        }

        .badge-regression {
            background: linear-gradient(45deg, #dc3545, #fd7e14);
            color: white;
        }

        .badge-stable {
            background: linear-gradient(45deg, #6c757d, #495057);
            color: white;
        }

        .filter-controls {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }

        [data-theme="dark"] .filter-controls {
            background: #343a40;
            color: #e9ecef;
        }

        .encoder-toggle {
            margin: 0.25rem;
            transition: all 0.3s ease;
        }

        .encoder-toggle:hover {
            transform: scale(1.05);
        }

        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        [data-theme="dark"] .theme-toggle {
            background: rgba(52, 58, 64, 0.9);
            color: #e9ecef;
        }

        .theme-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.25);
        }

        .benchmark-chart {
            width: 100%;
            height: 400px;
            max-height: 400px;
        }

        .trend-indicator {
            display: inline-flex;
            align-items: center;
            font-size: 0.9rem;
            margin-left: 0.5rem;
        }

        .trend-up {
            color: #dc3545;
        }

        .trend-down {
            color: #198754;
        }

        .trend-stable {
            color: #6c757d;
        }

        @media (max-width: 768px) {
            .hero-section {
                padding: 2rem 0;
            }

            .stats-card {
                margin: 0.5rem 0;
            }

            .chart-container {
                padding: 1rem;
                margin: 0.5rem 0;
            }

            .filter-controls {
                padding: 1rem;
            }

            .theme-toggle {
                top: 10px;
                right: 10px;
                width: 40px;
                height: 40px;
                font-size: 1rem;
            }
        }

        .hidden {
            display: none !important;
        }

        /* Loading animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Tooltip styles */
        .tooltip-inner {
            background-color: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.875rem;
            max-width: 300px;
        }
    </style>
</head>
<body>
    <!-- Theme Toggle Button -->
    <button class="theme-toggle" id="themeToggle" title="Toggle dark mode">
        <span id="themeIcon">🌙</span>
    </button>

    <!-- Hero Section -->
    <section class="hero-section">
        <div class="container hero-content">
            <div class="row">
                <div class="col-lg-9">
                    <h1 class="display-4 mb-3">BarcodeGenerator Benchmarks</h1>
                    <p class="lead mb-4">Continuous performance monitoring for the TyKonKet BarcodeGenerator .NET library. Track performance trends, regressions, and improvements across all encoder types.</p>
                    <div class="d-flex flex-wrap">
                        <span class="badge badge-bg-success me-2 mb-2">✓ Real-time Monitoring</span>
                        <span class="badge badge-bg-success me-2 mb-2">✓ Multi-Encoder Support</span>
                        <span class="badge badge-bg-success me-2 mb-2">✓ Regression Detection</span>
                        <span class="badge badge-bg-success me-2 mb-2">✓ Interactive Charts</span>
                    </div>
                </div>
                <div class="col-lg-3">
                    <div class="stats-card text-center">
                        <h3 id="totalEncoders">5</h3>
                        <p class="mb-0">Encoder Types</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <div class="container">
        <!-- Repository Info -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card shadow-sm">
                    <div class="card-body">
                        <div class="row align-items-center">
                            <div class="col-md-6">
                                <h6 class="card-title mb-1">Repository</h6>
                                <a id="repository-link" class="text-decoration-none" target="_blank" rel="noopener"></a>
                            </div>
                            <div class="col-md-6 text-md-end">
                                <h6 class="card-title mb-1">Last Update</h6>
                                <span id="last-update" class="text-muted"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Performance Overview -->
        <div class="row mb-4" id="overview-stats">
            <div class="col-md-4">
                <div class="card shadow-sm h-100">
                    <div class="card-body text-center">
                        <h5 class="card-title text-success">Fastest Encoder</h5>
                        <h3 id="fastest-encoder">-</h3>
                        <p class="card-text text-muted mb-0" id="fastest-time">-</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card shadow-sm h-100">
                    <div class="card-body text-center">
                        <h5 class="card-title text-warning">Average Performance</h5>
                        <h3 id="average-time">-</h3>
                        <p class="card-text text-muted mb-0">Across all encoders</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card shadow-sm h-100">
                    <div class="card-body text-center">
                        <h5 class="card-title text-info">Total Benchmarks</h5>
                        <h3 id="total-benchmarks">-</h3>
                        <p class="card-text text-muted mb-0">Data points collected</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Filter Controls -->
        <div class="filter-controls">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h6 class="mb-3">Filter Encoders</h6>
                    <div id="encoder-filters" class="d-flex flex-wrap">
                        <!-- Dynamic filter buttons will be inserted here -->
                    </div>
                </div>
                <div class="col-md-4 text-md-end">
                    <button class="btn btn-outline-secondary btn-sm me-2" onclick="showAllEncoders()">Show All</button>
                    <button class="btn btn-outline-secondary btn-sm" onclick="hideAllEncoders()">Hide All</button>
                    <button class="btn btn-primary btn-sm ms-2" id="download-btn">
                        📥 Download Data
                    </button>
                </div>
            </div>
        </div>

        <!-- Benchmark Charts -->
        <div id="charts-container">
            <!-- Dynamic charts will be inserted here -->
        </div>

        <!-- Footer -->
        <footer class="text-center text-muted py-4">
            <p>Powered by <a href="https://github.com/marketplace/actions/continuous-benchmark" target="_blank" rel="noopener">github-action-benchmark</a> | 
            Built with ❤️ for the <a href="https://github.com/TyKonKet/BarcodeGenerator" target="_blank" rel="noopener">BarcodeGenerator</a> project</p>
        </footer>
    </div>

    <!-- Chart.js from CDN with embedded fallback -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script>
        // Check if Chart.js loaded from CDN, if not use embedded version
        if (typeof Chart === 'undefined') {
            console.log('Chart.js CDN failed, using embedded fallback');
            // Here you would include the embedded Chart.js code
            // For this implementation, we'll create a simple custom chart if needed
        }
    </script>

    <!-- Data file (will be generated by the benchmark action) -->
    <script src="data.js"></script>

    <!-- Main application script -->
    <script>
        'use strict';
        
        class BenchmarkDashboard {
            constructor() {
                this.data = null;
                this.charts = new Map();
                this.hiddenEncoders = new Set();
                this.theme = localStorage.getItem('theme') || 'light';
                this.init();
            }

            async init() {
                this.setupTheme();
                this.setupEventListeners();
                await this.loadData();
                this.renderDashboard();
            }

            setupTheme() {
                document.documentElement.setAttribute('data-theme', this.theme);
                const themeIcon = document.getElementById('themeIcon');
                themeIcon.textContent = this.theme === 'dark' ? '☀️' : '🌙';
            }

            setupEventListeners() {
                document.getElementById('themeToggle').addEventListener('click', () => {
                    this.toggleTheme();
                });

                document.getElementById('download-btn').addEventListener('click', () => {
                    this.downloadData();
                });
            }

            toggleTheme() {
                this.theme = this.theme === 'light' ? 'dark' : 'light';
                localStorage.setItem('theme', this.theme);
                this.setupTheme();
            }

            async loadData() {
                try {
                    if (typeof window.BENCHMARK_DATA !== 'undefined') {
                        this.data = window.BENCHMARK_DATA;
                    } else {
                        throw new Error('Benchmark data not found');
                    }
                } catch (error) {
                    console.error('Failed to load benchmark data:', error);
                    this.showError('Failed to load benchmark data. Please try refreshing the page.');
                }
            }

            renderDashboard() {
                if (!this.data) return;

                this.renderHeader();
                this.renderOverviewStats();
                this.renderFilters();
                this.renderCharts();
            }

            renderHeader() {
                const lastUpdate = new Date(this.data.lastUpdate);
                document.getElementById('last-update').textContent = lastUpdate.toLocaleString();
                
                const repoLink = document.getElementById('repository-link');
                repoLink.href = this.data.repoUrl;
                repoLink.textContent = this.data.repoUrl;
            }

            renderOverviewStats() {
                const encoders = Object.keys(this.data.entries);
                const totalEncoders = encoders.length;
                
                // Calculate stats
                let fastestEncoder = '';
                let fastestTime = Infinity;
                let totalBenchmarks = 0;
                let allTimes = [];

                encoders.forEach(encoderName => {
                    const entries = this.data.entries[encoderName];
                    totalBenchmarks += entries.length;

                    entries.forEach(entry => {
                        entry.benches.forEach(bench => {
                            allTimes.push(bench.value);
                            if (bench.value < fastestTime) {
                                fastestTime = bench.value;
                                fastestEncoder = encoderName;
                            }
                        });
                    });
                });

                const averageTime = allTimes.length > 0 ? 
                    allTimes.reduce((a, b) => a + b, 0) / allTimes.length : 0;

                document.getElementById('totalEncoders').textContent = totalEncoders;
                document.getElementById('fastest-encoder').textContent = fastestEncoder.replace('Encoder', '');
                document.getElementById('fastest-time').textContent = 
                    fastestTime !== Infinity ? `${fastestTime.toFixed(2)} ns` : '-';
                document.getElementById('average-time').textContent = 
                    averageTime > 0 ? `${averageTime.toFixed(2)} ns` : '-';
                document.getElementById('total-benchmarks').textContent = totalBenchmarks;
            }

            renderFilters() {
                const container = document.getElementById('encoder-filters');
                container.innerHTML = ''; // Clear existing filters
                const encoders = Object.keys(this.data.entries);

                encoders.forEach(encoderName => {
                    const button = document.createElement('button');
                    // Start with all encoders shown (primary button style)
                    button.className = 'btn btn-primary btn-sm encoder-toggle me-2 mb-2';
                    button.textContent = encoderName.replace('Encoder', '');
                    button.dataset.encoder = encoderName;
                    button.onclick = () => this.toggleEncoder(encoderName);
                    container.appendChild(button);
                });
            }

            renderCharts() {
                const container = document.getElementById('charts-container');
                const encoders = Object.keys(this.data.entries);

                encoders.forEach(encoderName => {
                    if (this.hiddenEncoders.has(encoderName)) return;

                    const chartSection = this.createChartSection(encoderName);
                    container.appendChild(chartSection);
                    this.renderEncoderCharts(encoderName, chartSection);
                });
            }

            createChartSection(encoderName) {
                const section = document.createElement('div');
                section.className = 'row mb-4';
                section.dataset.encoder = encoderName;

                // Get performance trend
                const trend = this.calculatePerformanceTrend(encoderName);
                const trendBadge = this.createTrendBadge(trend);

                section.innerHTML = `
                    <div class="col-12">
                        <div class="chart-container">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h4 class="mb-0">${encoderName.replace('Encoder', '')} Performance ${trendBadge}</h4>
                                <small class="text-muted">Click points to view commit details</small>
                            </div>
                            <div class="benchmark-charts" id="charts-${encoderName}">
                                <!-- Charts will be rendered here -->
                            </div>
                        </div>
                    </div>
                `;

                return section;
            }

            calculatePerformanceTrend(encoderName) {
                const entries = this.data.entries[encoderName];
                if (entries.length < 2) return 'stable';

                const recent = entries.slice(-3); // Last 3 entries
                const older = entries.slice(-6, -3); // Previous 3 entries

                if (recent.length === 0 || older.length === 0) return 'stable';

                const recentAvg = this.calculateAveragePerformance(recent);
                const olderAvg = this.calculateAveragePerformance(older);

                const changePercent = ((recentAvg - olderAvg) / olderAvg) * 100;

                if (changePercent > 10) return 'regression';
                if (changePercent < -10) return 'improvement';
                return 'stable';
            }

            calculateAveragePerformance(entries) {
                let total = 0;
                let count = 0;

                entries.forEach(entry => {
                    entry.benches.forEach(bench => {
                        total += bench.value;
                        count++;
                    });
                });

                return count > 0 ? total / count : 0;
            }

            createTrendBadge(trend) {
                const trends = {
                    improvement: { icon: '📈', text: 'Improved', class: 'badge-improved' },
                    regression: { icon: '📉', text: 'Regression', class: 'badge-regression' },
                    stable: { icon: '➡️', text: 'Stable', class: 'badge-stable' }
                };

                const t = trends[trend];
                return `<span class="performance-badge ${t.class}">${t.icon} ${t.text}</span>`;
            }

            renderEncoderCharts(encoderName, container) {
                const entries = this.data.entries[encoderName];
                const chartsContainer = container.querySelector(`#charts-${encoderName}`);
                
                // Group benchmarks by name
                const benchmarkGroups = this.groupBenchmarksByName(entries);

                Object.keys(benchmarkGroups).forEach(benchmarkName => {
                    const chartDiv = document.createElement('div');
                    chartDiv.className = 'col-12 mb-4';
                    
                    const canvas = document.createElement('canvas');
                    canvas.className = 'benchmark-chart';
                    canvas.id = `chart-${encoderName}-${benchmarkName.replace(/[^a-zA-Z0-9]/g, '')}`;
                    
                    chartDiv.appendChild(canvas);
                    chartsContainer.appendChild(chartDiv);

                    this.createChart(canvas, benchmarkName, benchmarkGroups[benchmarkName]);
                });
            }

            groupBenchmarksByName(entries) {
                const groups = {};

                entries.forEach(entry => {
                    entry.benches.forEach(bench => {
                        const name = bench.name.split('.').pop(); // Get the last part of the name
                        if (!groups[name]) {
                            groups[name] = [];
                        }
                        groups[name].push({
                            ...bench,
                            commit: entry.commit,
                            date: entry.date
                        });
                    });
                });

                return groups;
            }

            createChart(canvas, title, data) {
                // Fallback chart implementation if Chart.js is not available
                if (typeof Chart === 'undefined') {
                    this.createFallbackChart(canvas, title, data);
                    return;
                }

                const ctx = canvas.getContext('2d');
                
                // Sort data by date
                data.sort((a, b) => a.date - b.date);

                const chart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: data.map(d => d.commit.id.slice(0, 7)),
                        datasets: [{
                            label: title,
                            data: data.map(d => d.value),
                            borderColor: this.getEncoderColor(title),
                            backgroundColor: this.getEncoderColor(title) + '20',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4,
                            pointBackgroundColor: this.getEncoderColor(title),
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2,
                            pointRadius: 6,
                            pointHoverRadius: 8
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            intersect: false,
                            mode: 'index'
                        },
                        plugins: {
                            title: {
                                display: true,
                                text: title,
                                font: {
                                    size: 16,
                                    weight: 'bold'
                                }
                            },
                            legend: {
                                display: false
                            },
                            tooltip: {
                                backgroundColor: this.theme === 'dark' ? 'rgba(52, 58, 64, 0.95)' : 'rgba(255, 255, 255, 0.95)',
                                titleColor: this.theme === 'dark' ? '#f8f9fa' : '#212529',
                                bodyColor: this.theme === 'dark' ? '#e9ecef' : '#495057',
                                borderColor: this.getEncoderColor(title),
                                borderWidth: 2,
                                cornerRadius: 8,
                                padding: 12,
                                displayColors: false,
                                titleFont: {
                                    size: 14,
                                    weight: 'bold'
                                },
                                bodyFont: {
                                    size: 13
                                },
                                callbacks: {
                                    title: (context) => {
                                        const point = data[context[0].dataIndex];
                                        return `Commit: ${point.commit.id.slice(0, 7)}`;
                                    },
                                    beforeBody: (context) => {
                                        const point = data[context[0].dataIndex];
                                        return [
                                            `Date: ${new Date(point.date).toLocaleDateString()}`,
                                            `Message: ${point.commit.message.split('\n')[0]}`
                                        ];
                                    },
                                    label: (context) => {
                                        const point = data[context.dataIndex];
                                        return `Performance: ${point.value.toFixed(2)} ${point.unit}${point.range ? ` (±${point.range})` : ''}`;
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: 'Commits'
                                },
                                grid: {
                                    color: this.theme === 'dark' ? '#495057' : '#e0e0e0'
                                }
                            },
                            y: {
                                title: {
                                    display: true,
                                    text: data.length > 0 ? data[0].unit : 'Performance'
                                },
                                beginAtZero: true,
                                grid: {
                                    color: this.theme === 'dark' ? '#495057' : '#e0e0e0'
                                }
                            }
                        },
                        onClick: (event, elements) => {
                            if (elements.length > 0) {
                                const index = elements[0].index;
                                const point = data[index];
                                window.open(point.commit.url, '_blank');
                            }
                        }
                    }
                });

                this.charts.set(canvas.id, chart);
            }

            createFallbackChart(canvas, title, data) {
                // Simple fallback chart when Chart.js is not available
                const ctx = canvas.getContext('2d');
                const rect = canvas.getBoundingClientRect();
                canvas.width = rect.width;
                canvas.height = rect.height;

                ctx.fillStyle = this.theme === 'dark' ? '#343a40' : '#fff';
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                ctx.fillStyle = this.theme === 'dark' ? '#e9ecef' : '#333';
                ctx.font = '16px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(title, canvas.width / 2, 30);
                ctx.fillText('Chart.js not available - Using fallback', canvas.width / 2, canvas.height / 2);
                ctx.fillText(`${data.length} data points available`, canvas.width / 2, canvas.height / 2 + 30);
            }

            getEncoderColor(encoderName) {
                const colors = {
                    'Ean8': '#FF6384',
                    'Ean13': '#36A2EB', 
                    'Upca': '#FFCE56',
                    'Isbn13': '#4BC0C0',
                    'Code93': '#9966FF',
                    'SimpleInstance': '#FF6384',
                    'AdvancedInstance': '#36A2EB',
                    'EncodingWithoutText': '#FFCE56',
                    'EncodingWithText': '#4BC0C0'
                };

                for (const [key, color] of Object.entries(colors)) {
                    if (encoderName.includes(key)) {
                        return color;
                    }
                }

                return '#666666';
            }

            toggleEncoder(encoderName) {
                const button = document.querySelector(`[data-encoder="${encoderName}"]`);
                const chartSection = document.querySelector(`[data-encoder="${encoderName}"]:not(.encoder-toggle)`);

                if (this.hiddenEncoders.has(encoderName)) {
                    // Show the encoder
                    this.hiddenEncoders.delete(encoderName);
                    button.classList.remove('btn-outline-primary');
                    button.classList.add('btn-primary');
                    if (chartSection) chartSection.classList.remove('hidden');
                } else {
                    // Hide the encoder
                    this.hiddenEncoders.add(encoderName);
                    button.classList.remove('btn-primary');
                    button.classList.add('btn-outline-primary');
                    if (chartSection) chartSection.classList.add('hidden');
                }
            }

            downloadData() {
                const dataStr = JSON.stringify(this.data, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                
                const link = document.createElement('a');
                link.href = url;
                link.download = 'benchmark_data.json';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
            }

            showError(message) {
                const container = document.getElementById('charts-container');
                container.innerHTML = `
                    <div class="col-12">
                        <div class="alert alert-danger" role="alert">
                            <h4 class="alert-heading">Error</h4>
                            <p>${message}</p>
                        </div>
                    </div>
                `;
            }
        }

        // Global functions for filter controls
        function showAllEncoders() {
            window.dashboard.hiddenEncoders.clear();
            document.querySelectorAll('.encoder-toggle').forEach(btn => {
                btn.classList.remove('btn-outline-primary');
                btn.classList.add('btn-primary');
            });
            document.querySelectorAll('[data-encoder]:not(.encoder-toggle)').forEach(section => {
                section.classList.remove('hidden');
            });
        }

        function hideAllEncoders() {
            const encoders = Object.keys(window.dashboard.data.entries);
            encoders.forEach(encoder => window.dashboard.hiddenEncoders.add(encoder));
            document.querySelectorAll('.encoder-toggle').forEach(btn => {
                btn.classList.remove('btn-primary');
                btn.classList.add('btn-outline-primary');
            });
            document.querySelectorAll('[data-encoder]:not(.encoder-toggle)').forEach(section => {
                section.classList.add('hidden');
            });
        }

        // Initialize dashboard when page loads
        document.addEventListener('DOMContentLoaded', () => {
            window.dashboard = new BenchmarkDashboard();
        });
    </script>
</body>
</html>